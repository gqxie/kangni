<!DOCTYPE html>
<html>
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>违章记录报告</title>
    <link rel="stylesheet" href="{% static 'layui/css/layui.css' %}" media="all">
    <style>
        body {
            margin: 10px;
        }

        .layui-table-cell {
            height: 120px !important;
            line-height: 120px !important;
        }
    </style>
</head>
<body>
<table class="layui-hide" id="demo"></table>
<div style="display: none;">
    <table id="data_export">
    </table>
</div>
<script src="{% static 'layui/layui.all.js' %}" charset="utf-8"></script>
<script>
    layui.config({
        version: '1560414887305' //为了更新 js 缓存，可忽略
    });

    layui.use(['table'], function () {
        var table = layui.table,
            $ = layui.jquery;//表格

        //执行一个 table 实例
        var ins = table.render({
            elem: '#demo'
            //, height: 'full-200'
            , url: 'getUser' //数据接口
            , title: '违章记录报告'
            , page: true //开启分页
            , toolbar: true //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            , totalRow: false //开启合计行
            , skin: 'row' //行边框风格
            , even: true //开启隔行背景
            , size: 'sm' //小尺寸的表格
            , cols: [[ //表头
                {type: 'checkbox', fixed: 'left'}
                , {field: 'eventId', title: '序号', width: 80, sort: true, fixed: 'left'}
                , {field: 'employeName', title: '违章人员', width: 120}
                , {field: 'districtName', title: '作业场所', width: 120}
                , {field: 'positionName', title: '作业单位', width: 120}
                , {field: 'eventType', title: '违章行为', width: 120}
                , {
                    field: 'photo', title: '违章行为抓拍', width: 120, templet: function (d) {
                        var uri = 'media' + d.photo.split('media')[1];
                        return '<a href="' + uri + '" class="layui-table-link" target="_blank">' + '<img height="120" weight="80" src="' + d.photo + '"/>' + '</a>'
                    }
                }
                , {field: 'createTime', title: '违章时间', width: 180}
            ]]
        });

        var ins1 = table.render({
            elem: '#data_export',
            url: "getAllEvent", //数据接口
            method: 'post',
            title: '违章记录报告',
            where: {
                mycode: "all"
            },
            limit: 10,
            cols: [[
                {field: 'eventId', title: '序号', width: 80, sort: true, fixed: 'left'}
                , {field: 'employeName', title: '违章人员', width: 120}
                , {field: 'districtName', title: '作业场所', width: 120}
                , {field: 'positionName', title: '作业单位', width: 120}
                , {field: 'eventType', title: '违章行为', width: 120}
                , {field: 'photo', title: '违章抓拍照片链接', width: 120}
                , {field: 'createTime', title: '违章时间', width: 180}
            ]],
            done: function (res, curr, count) {
                exportData = res.data;
            }
        });

        $('div[title="导出"]').click(function () {
            $(this).attr('lay-event', 'ads');
            //导出按钮
            table.exportFile(ins1.config.id, exportData, 'xls');
        })

    });
</script>
</body>
</html>
